this.ckan.module("activity-stream",(function(o){return{options:{more:null,id:null,context:null,offset:null,loading:!1},initialize:function(){o.proxyAll(this,/_on/);var t=this.options;t.more="True"==t.more,this._onBuildLoadMore(),o(window).on("scroll",this._onScrollIntoView),this._onScrollIntoView()},elementInViewport:function(o){for(var t=o.offsetTop,e=o.offsetLeft,i=o.offsetWidth,n=o.offsetHeight;o.offsetParent;)t+=(o=o.offsetParent).offsetTop,e+=o.offsetLeft;return t<window.pageYOffset+window.innerHeight&&e<window.pageXOffset+window.innerWidth&&t+n>window.pageYOffset&&e+i>window.pageXOffset},_onScrollIntoView:function(){var t=o(".load-more a",this.el);1==t.length&&(this.elementInViewport(t[0])&&!this.options.loading&&t.trigger("click"))},_onBuildLoadMore:function(){var t=this.options;t.more&&(o(".load-more",this.el).on("click","a",this._onLoadMoreClick),t.offset=o(".item",this.el).length)},_onLoadMoreClick:function(t){t.preventDefault();var e=this.options;e.loading||(e.loading=!0,o(".load-more a",this.el).html(this._("Loading...")).addClass("disabled"),this.sandbox.client.call("GET",e.context+"_activity_list_html","?id="+e.id+"&offset="+e.offset,this._onActivitiesLoaded))},_onActivitiesLoaded:function(t){var e=this.options,i=o(t.result);e.more="True"==i.data("module-more"),e.offset+=30,o(".load-less",i).remove(),o(".load-more",this.el).remove(),o("li",i).appendTo(this.el),this._onBuildLoadMore(),e.loading=!1}}}));