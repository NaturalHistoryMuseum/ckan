this.ckan.module("autocomplete",(function(t){return{options:{tags:!1,key:!1,label:!1,items:10,source:null,tokensep:",",interval:300,dropdownClass:"",containerClass:""},initialize:function(){t.proxyAll(this,/_on/,/format/),this.setupAutoComplete()},setupAutoComplete:function(){var t={width:"resolve",formatResult:this.formatResult,formatNoMatches:this.formatNoMatches,formatInputTooShort:this.formatInputTooShort,dropdownCssClass:this.options.dropdownClass,containerCssClass:this.options.containerClass,tokenSeparators:this.options.tokensep.split("")};if(this.el.is("select")){if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)&&new Number(RegExp.$1)<=7)return}else this.options.tags?t.tags=this._onQuery:(t.query=this._onQuery,t.createSearchChoice=this.formatTerm),t.initSelection=this.formatInitialValue;var e=this.el.select2(t).data("select2");this.options.tags&&e&&e.search&&e.search.on("keydown",this._onKeydown),$(".select2-choice",e.container).on("click",(function(){return!1})),this._select2=e},getCompletions:function(e,o){var s=this.options.source.split("?"),n=s.pop(),i=s.join("?")+encodeURIComponent(e)+n,r=this.sandbox.client,a={format:function(e){var o=t.extend(a,{objects:!0});return{results:r.parseCompletions(e,o)}},key:this.options.key,label:this.options.label};return r.getCompletions(i,a,o)},lookup:function(t,e){var o=this;this._lastTerm=t,clearTimeout(this._debounced),e({results:[]}),t&&(this._debounced=setTimeout((function(){var t=o._lastTerm;o._last&&"function"==typeof o._last.abort&&o._last.abort(),o._last=o.getCompletions(t,e)}),this.options.interval),$(".select2-search input",this._select2.dropdown).addClass("select2-active"))},formatResult:function(t,e,o){var s=this._lastTerm||null;return e&&e.attr("data-value",t.id),t.text.split(s).join(s&&s.bold())},formatNoMatches:function(t){return t?this._("No matches found"):this._("Start typingâ€¦")},formatInputTooShort:function(t,e){return this.ngettext("Input is too short, must be at least one character","Input is too short, must be at least %(num)d characters",e)},formatTerm:function(e){return{id:(e=t.trim(e||"")).replace(/,/g,","),text:e}},formatInitialValue:function(e,o){var s,n=t.trim(e.val()||"");return s=this.options.tags?t.map(n.split(","),this.formatTerm):this.formatTerm(n),"function"==typeof o&&o(s),s},_onQuery:function(t){t&&this.lookup(t.term,t.callback)},_onKeydown:function(e){(void 0!==e.key?","===e.key:188===e.which)&&(e.preventDefault(),setTimeout((function(){var o=t.Event("keydown",{which:13});t(e.target).trigger(o)}),10))}}}));