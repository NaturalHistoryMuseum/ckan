this.ckan.module("resource-reorder",(function(e){return{options:{id:!1,labelText:"Reorder resources"},template:{title:"<h1></h1>",button:['<a href="javascript:;" class="btn btn-default">','<i class="fa fa-bars"></i>',"<span></span>","</a>"].join("\n"),form_actions:['<div class="form-actions">','<a href="javascript:;" class="cancel btn btn-danger pull-left" aria-label="Cancel"></a>','<a href="javascript:;" class="save btn btn-primary" aria-label="Save changes"></a>',"</div>"].join("\n"),handle:['<a href="javascript:;" class="handle" aria-label="Click and drag this to move the resource up or down in the list">','<i class="fa fa-arrows"></i>',"</a>"].join("\n"),saving:['<span class="saving text-muted m-right">','<i class="fa fa-spinner fa-spin"></i>',"<span></span>","</span>"].join("\n")},is_reordering:!1,cache:!1,initialize:function(){jQuery.proxyAll(this,/_on/);var t=this._(this.options.labelText);this.html_title=e(this.template.title).text(t).insertBefore(this.el).hide();var a=e(this.template.button).on("click",this._onHandleStartReorder).appendTo(".page_primary_action");e("span",a).text(t),this.html_form_actions=e(this.template.form_actions).hide().insertAfter(this.el),e(".save",this.html_form_actions).text(this._("Save order")).on("click",this._onHandleSave),e(".cancel",this.html_form_actions).text(this._("Cancel")).on("click",this._onHandleCancel),this.html_handles=e(this.template.handle).hide().appendTo(e(".resource-item",this.el)),this.html_saving=e(this.template.saving).hide().insertBefore(e(".save",this.html_form_actions)),e("span",this.html_saving).text(this._("Saving...")),this.cache=this.el.html(),this.el.sortable().sortable("disable")},_onHandleStartReorder:function(){this.is_reordering||(this.html_form_actions.add(this.html_handles).add(this.html_title).show(),this.el.addClass("reordering").sortable("enable"),e(".page_primary_action").hide(),this.is_reordering=!0)},_onHandleCancel:function(){this.is_reordering&&!e(".cancel",this.html_form_actions).hasClass("disabled")&&(this.reset(),this.is_reordering=!1,this.el.html(this.cache).sortable().sortable("disable"),this.html_handles=e(".handle",this.el))},_onHandleSave:function(){if(!e(".save",this.html_form_actions).hasClass("disabled")){var t=this;t.html_saving.show(),e(".save, .cancel",t.html_form_actions).addClass("disabled");var a=[];e(".resource-item",t.el).each((function(){a.push(e(this).data("id"))})),t.sandbox.client.call("POST","package_resource_reorder",{id:t.options.id,order:a},(function(){t.html_saving.hide(),e(".save, .cancel",t.html_form_actions).removeClass("disabled"),t.cache=t.el.html(),t.reset(),t.is_reordering=!1}))}},reset:function(){this.html_form_actions.add(this.html_handles).add(this.html_title).hide(),this.el.removeClass("reordering").sortable("disable"),e(".page_primary_action").show()}}}));