this.ckan.module("resource-reorder",(function(t){return{options:{id:!1,labelText:"Reorder resources"},template:{title:"<h1></h1>",button:['<a href="javascript:;" class="btn btn-default">','<i class="fa fa-bars"></i>',"<span></span>","</a>"].join("\n"),form_actions:['<div class="form-actions">','<a href="javascript:;" class="cancel btn btn-danger pull-left"></a>','<a href="javascript:;" class="save btn btn-primary"></a>',"</div>"].join("\n"),handle:['<a href="javascript:;" class="handle">','<i class="fa fa-arrows"></i>',"</a>"].join("\n"),saving:['<span class="saving text-muted m-right">','<i class="fa fa-spinner fa-spin"></i>',"<span></span>","</span>"].join("\n")},is_reordering:!1,cache:!1,initialize:function(){jQuery.proxyAll(this,/_on/);var e=this._(this.options.labelText);this.html_title=t(this.template.title).text(e).insertBefore(this.el).hide();var s=t(this.template.button).on("click",this._onHandleStartReorder).appendTo(".page_primary_action");t("span",s).text(e),this.html_form_actions=t(this.template.form_actions).hide().insertAfter(this.el),t(".save",this.html_form_actions).text(this._("Save order")).on("click",this._onHandleSave),t(".cancel",this.html_form_actions).text(this._("Cancel")).on("click",this._onHandleCancel),this.html_handles=t(this.template.handle).hide().appendTo(t(".resource-item",this.el)),this.html_saving=t(this.template.saving).hide().insertBefore(t(".save",this.html_form_actions)),t("span",this.html_saving).text(this._("Saving...")),this.cache=this.el.html(),this.el.sortable().sortable("disable")},_onHandleStartReorder:function(){this.is_reordering||(this.html_form_actions.add(this.html_handles).add(this.html_title).show(),this.el.addClass("reordering").sortable("enable"),t(".page_primary_action").hide(),this.is_reordering=!0)},_onHandleCancel:function(){this.is_reordering&&!t(".cancel",this.html_form_actions).hasClass("disabled")&&(this.reset(),this.is_reordering=!1,this.el.html(this.cache).sortable().sortable("disable"),this.html_handles=t(".handle",this.el))},_onHandleSave:function(){if(!t(".save",this.html_form_actions).hasClass("disabled")){var e=this;e.html_saving.show(),t(".save, .cancel",e.html_form_actions).addClass("disabled");var s=[];t(".resource-item",e.el).each((function(){s.push(t(this).data("id"))})),e.sandbox.client.call("POST","package_resource_reorder",{id:e.options.id,order:s},(function(){e.html_saving.hide(),t(".save, .cancel",e.html_form_actions).removeClass("disabled"),e.cache=e.el.html(),e.reset(),e.is_reordering=!1}))}},reset:function(){this.html_form_actions.add(this.html_handles).add(this.html_title).hide(),this.el.removeClass("reordering").sortable("disable"),t(".page_primary_action").show()}}}));