ckan.module("resource-view-filters-form",(function(t){"use strict";function e(t,e){var i=t.parent().find("input"),n=t.val();i.select2({width:"resolve",minimumInputLength:0,ajax:{url:ckan.url("/api/3/action/datastore_search"),datatype:"json",quietMillis:200,cache:!0,data:function(t,i){var r;if(r={resource_id:e,limit:20,offset:20*(i-1),fields:n,distinct:!0,sort:n,include_total:!1},""!==t){var o={};-1==t.indexOf(" ")&&(t+=":*",r.plain=!1),o[n]=t,r.q=JSON.stringify(o)}return r},results:function(t,e){var i=t.result.records,r=20==i.length;return{results:$.map(i,(function(t){return{id:t[n],text:String(t[n])}})),more:r}}},initSelection:function(t,e){e({id:t.val(),text:t.val()})}})}return{initialize:function(){var t=this.options.resourceId,i=this.options.templateFilterInputs,n=$(i).find('input[type="text"][name]'),r=this.el.find(this.options.filtersSelector),o=this.el.find(this.options.addFilterSelector),l=this.options.removeFilterSelector;r.find("select").each((function(i,n){e($(n),t)})),o.click((function(n){n.preventDefault(),r.append(i),e(r.children().last().find("select"),t)})),r.on("click",l,(function(t){t.preventDefault(),$(this).parent().remove()})),r.on("change","select",(function(i){var r=$(this),o=r.parent(),l=o.find("input"),s=o.find(".select2-container");i.preventDefault(),s.remove(),l.replaceWith(n.clone()),e(r,t)}))}}}));