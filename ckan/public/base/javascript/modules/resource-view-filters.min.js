this.ckan.module("resource-view-filters",(function(e){"use strict";function t(e,t,n,r,a){return $.each(r,(function(r,s){a.hasOwnProperty(s)&&e.append(function(e,n,r){var s=a[r]||[],l=(n=$(n.replace(/{filter}/g,r))).find(".resource-view-filter-values");(s=s.concat([void 0])).forEach((function(e,t){var i=$('<input type="hidden" name="'+r+'"></input>');void 0!==e&&i.val(e),l.append(i)}));return l.find("input").select2({allowClear:!0,placeholder:" ",width:"resolve",minimumInputLength:0,ajax:{url:ckan.url("/api/3/action/datastore_search"),datatype:"json",quietMillis:200,cache:!0,data:function(e,i){var n;if(n={resource_id:t,limit:20,offset:20*(i-1),fields:r,distinct:!0,sort:r,include_total:!1},""!==e){var a={};-1==e.indexOf(" ")&&(e+=":*",n.plain=!1),a[r]=e,n.q=JSON.stringify(a)}return n},results:function(e,t){var i=e.result.records,n=20==i.length;return{results:$.map(i,(function(e){return{id:e[r],text:String(e[r])}})),more:n}}},initSelection:function(e,t){t({id:e.val(),text:e.val()})}}).on("change",i),n}(self.el,n,s))})),e}function i(e){var t=e.currentTarget.name,i=e.val,n=ckan.views.filters.get(t)||[],r=n.length;n=n.slice(),e.removed&&-1!==(r=n.indexOf(e.removed.id))&&n.splice(r,1),e.added&&n.splice(r,0,i),n.length>0?ckan.views.filters.set(t,n):ckan.views.filters.unset(t)}return{initialize:function(){var e=this.options.resourceId,i=this.options.fields,n=this.options.dropdownTemplate,r='<a class="btn btn-primary" href="#">'+this._("Add Filter")+"</a>",a=$("<div></div>"),s=ckan.views.filters.get();t(a,e,n,i,s);var l=function(e,t,i,n,r,a){var s=$(i),l=(Object.keys(r),$.grep(n,(function(e){return!r.hasOwnProperty(e)}))),c=$.map(l,(function(e){return{id:e,text:e}}));if(0===c.length)return"";return s.click((function(i){var n=$('<div class="resource-view-filter"><input type="hidden"></input></div>'),r=n.find("input");t.append(n),r.select2({data:c,placeholder:e._("Select a field"),width:"resolve"}).on("change",a),i.preventDefault()})),s}(this,a,r,i,s,(function(r){var s={};s[r.val]=[],$(this).select2("destroy"),t(a,e,n,i,s),r.preventDefault()}));this.el.append(a),this.el.append(l)},options:{dropdownTemplate:['<div class="resource-view-filter">',"  {filter}:",'  <div class="resource-view-filter-values"></div>',"</div>"].join("\n")}}}));