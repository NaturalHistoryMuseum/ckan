String.prototype.queryStringToJSON=String.prototype.queryStringToJSON||function(){var params=String(this);if(params=params.substring(params.indexOf("?")+1),params=params.replace(/\+/g,"%20"),"{"===params.substring(0,1)&&"}"===params.substring(params.length-1))return eval(decodeURIComponent(params));params=params.split(/\&(amp\;)?/);for(var json={},i=0,n=params.length;i<n;++i){var param=params[i]||null;if(null!==param&&(param=param.split("="),null!==param)){var key=param[0]||null;if(null!==key&&void 0!==param[1]){var value=param[1];key=decodeURIComponent(key),value=decodeURIComponent(value);var keys=key.split(".");if(1===keys.length)json[key]=value;else{var path="",cmd="";$.each(keys,(function(ii,key){path+='["'+key.replace(/"/g,'\\"')+'"]',jsonCLOSUREGLOBAL=json,cmd="if ( typeof jsonCLOSUREGLOBAL"+path+' === "undefined" ) jsonCLOSUREGLOBAL'+path+" = {}",eval(cmd),json=jsonCLOSUREGLOBAL,delete jsonCLOSUREGLOBAL})),jsonCLOSUREGLOBAL=json,valueCLOSUREGLOBAL=value,cmd="jsonCLOSUREGLOBAL"+path+" = valueCLOSUREGLOBAL",eval(cmd),json=jsonCLOSUREGLOBAL,delete jsonCLOSUREGLOBAL,delete valueCLOSUREGLOBAL}}}}return json},this.ckan=this.ckan||{},this.ckan.views=this.ckan.views||{},this.ckan.views.filters=function(a){"use strict";var r={get:e,set:function(a,r){var e=window.location.href;n(a,r,e)},setAndRedirectTo:n,unset:function(a,n){var s=e(a);if(s){var i=s.length;s===n||void 0===n?delete r._searchParams.filters[a]:$.isArray(s)&&(0===(s=function(a,r){var e=a.slice(0);$.isArray(r)||(r=[r]);for(var n=0;n<r.length;n++){var t=$.inArray(r[n],e);t>-1&&e.splice(t,1)}return e}(s,n)).length?delete r._searchParams.filters[a]:r._searchParams.filters[a]=s),(void 0===e(a)||e(a).length!=i)&&t(window.location.href)}return r},_searchParams:{},_initialize:s,_setLocationHref:function(a){window.location.href=a}};function e(a){var e=r._searchParams.filters||{};return a?e[a]:e}function n(a,e,n){return r._searchParams.filters=r._searchParams.filters||{},r._searchParams.filters[a]=e,t(n),r}function t(a){var e;e=a.split("?")[0]+"?"+function(a){var e=$.extend({},a||{},r._searchParams);e.filters&&(e.filters=$.map(e.filters,(function(a,r){return $.isArray(a)||(a=[a]),$.map(a,(function(a){return r+":"+a})).join("|")})).join("|"));return $.param(e)}((a.split("?")[1]||"").queryStringToJSON()),r._setLocationHref(e)}function s(a){var e=a.queryStringToJSON();if(e.filters){var n,t,s={},i=String(e.filters).split("|");for(n=0,t=i.length;n<t;n++){var o=i[n].match(/([^:]+):(.*)/),l=o[1],c=o[2];s[l]=s[l]||[],s[l].push(c)}e.filters=s}r._searchParams=e}return s(a),r}(window.location.search);